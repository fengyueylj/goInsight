(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5406ec54"],{"0f7c":function(e,t,r){},"432b":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("5530"),s=r("5880"),o={computed:Object(a["a"])(Object(a["a"])({},Object(s["mapState"])({layout:function(e){return e.app.layout},navTheme:function(e){return e.app.theme},primaryColor:function(e){return e.app.color},colorWeak:function(e){return e.app.weak},fixedHeader:function(e){return e.app.fixedHeader},fixedSidebar:function(e){return e.app.fixedSidebar},contentWidth:function(e){return e.app.contentWidth},autoHideHeader:function(e){return e.app.autoHideHeader},isMobile:function(e){return e.app.isMobile},sideCollapsed:function(e){return e.app.sideCollapsed},multiTab:function(e){return e.app.multiTab}})),{},{isTopMenu:function(){return"topmenu"===this.layout}}),methods:{isSideMenu:function(){return!this.isTopMenu}}}},"4ad3":function(e,t,r){"use strict";r.d(t,"s",(function(){return s})),r.d(t,"j",(function(){return o})),r.d(t,"l",(function(){return i})),r.d(t,"k",(function(){return n})),r.d(t,"t",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"n",(function(){return d})),r.d(t,"m",(function(){return u})),r.d(t,"v",(function(){return m})),r.d(t,"i",(function(){return p})),r.d(t,"q",(function(){return f})),r.d(t,"o",(function(){return h})),r.d(t,"p",(function(){return b})),r.d(t,"h",(function(){return v})),r.d(t,"g",(function(){return g})),r.d(t,"r",(function(){return _})),r.d(t,"b",(function(){return k})),r.d(t,"a",(function(){return y})),r.d(t,"f",(function(){return x})),r.d(t,"u",(function(){return D})),r.d(t,"d",(function(){return w})),r.d(t,"w",(function(){return q})),r.d(t,"e",(function(){return S})),r.d(t,"x",(function(){return C}));r("99af");var a=r("b775"),s=a["b"].request({url:"/users/list",method:"get"}),o=a["b"].request({url:"/sqlorders/envs",method:"get"}),i=a["b"].request({url:"/sqlorders/versions/get",method:"get"}),n=function(e){return a["b"].request({url:"/sqlorders/schemas",method:"get",params:e})},l=function(e){return a["b"].request({url:"/sqlorders/incep/syntaxcheck",method:"post",data:e})},c=function(e){return a["b"].request({url:"/sqlorders/commit",method:"post",data:e})},d=function(e){return a["b"].request({url:"/sqlorders/list",method:"get",params:e})},u=function(e){return a["b"].request({url:"/sqlorders/detail/".concat(e),method:"get"})},m=function(e){return a["b"].request({url:"/sqlorders/op/".concat(e.action,"/").concat(e.pk),method:"put",data:e})},p=function(e){return a["b"].request({url:"/sqlorders/tasks/generate",method:"post",data:e})},f=function(e){return a["b"].request({url:"/sqlorders/tasks/preview/".concat(e.task_id),method:"get",params:e})},h=function(e){return a["b"].request({url:"/sqlorders/tasks/get/".concat(e.order_id),method:"get",params:e})},b=function(e){return a["b"].request({url:"/sqlorders/tasks/list/".concat(e.task_id),method:"get",params:e})},v=function(e){return a["b"].request({url:"/sqlorders/tasks/execute/single",method:"post",data:e})},g=function(e){return a["b"].request({url:"/sqlorders/tasks/execute/multi",method:"post",data:e})},_=function(e){return a["b"].request({url:"/sqlorders/tasks/result/".concat(e),method:"get"})},k=function(e){return a["b"].request({url:"/sqlorders/tasks/throttle",method:"post",data:e})},y=function(e){return a["b"].request({url:"/sqlorders/hook",method:"post",data:e})},x=function(e){return a["b"].request({url:"/sqlorders/export/download/".concat(e),method:"get",responseType:"blob"})},D=function(e){return a["b"].request({url:"/sqlorders/versions/list",method:"get",params:e})},w=function(e){return a["b"].request({url:"/sqlorders/versions/create",method:"post",data:e})},q=function(e){return a["b"].request({url:"/sqlorders/versions/update/".concat(e.key),method:"put",data:e})},S=function(e){return a["b"].request({url:"/sqlorders/versions/delete/".concat(e),method:"delete",data:e})},C=function(e){return a["b"].request({url:"/sqlorders/versions/view/".concat(e),method:"get",params:e})}},"620e":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-card",[e.orderDetail?r("page-header-wrapper",{attrs:{title:e.orderDetail.title},scopedSlots:e._u([{key:"content",fn:function(){return[r("a-descriptions",{attrs:{size:"small",column:e.isMobile?1:2}},[r("a-descriptions-item",{attrs:{label:"申请人"}},[e._v(e._s(e.orderDetail.applicant))]),r("a-descriptions-item",{attrs:{label:"备注"}},[e._v(e._s(e.orderDetail.remark))]),r("a-descriptions-item",{attrs:{label:"工单环境"}},[r("span",{staticStyle:{color:"red"}},[e._v(e._s(e.orderDetail.env_id))])]),r("a-descriptions-item",{attrs:{label:"工单类型"}},[e._v(e._s(e.orderDetail.sql_type))]),r("a-descriptions-item",{attrs:{label:"DB类型"}},[e._v(e._s(e.orderDetail.display_rds_category))]),r("a-descriptions-item",{attrs:{label:"DB实例"}},[e._v(e._s(e.orderDetail.host+":"+e.orderDetail.port))]),r("a-descriptions-item",{attrs:{label:"库名"}},[r("span",{staticStyle:{color:"blue"}},[e._v(e._s(e.orderDetail.database))])]),r("a-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.orderDetail.created_at))]),r("a-descriptions-item",{attrs:{label:"需求"}},[e._v(e._s(e.orderDetail.demand))])],1)]},proxy:!0},{key:"extraContent",fn:function(){return[r("a-row",{staticClass:"status-list"},[r("a-col",{attrs:{xs:24,sm:24}},[r("div",{staticClass:"text"},[e._v("状态")]),r("div",{staticClass:"heading"},[r("h2",[e._v(e._s(e.orderDetail.progress))])])])],1)]},proxy:!0},{key:"extra",fn:function(){return[r("a-button-group",{staticStyle:{"margin-right":"4px"}},[r("a-button",{attrs:{type:"dashed",disabled:e.btnStatus.btnDisabled,icon:"retweet"},on:{click:e.showModal}},[e._v(" "+e._s(e._f("btnTitle")(e.orderDetail.progress))+" ")]),"已复核"===e.orderDetail.progress?r("a-button",{attrs:{icon:"link"},on:{click:e.showHookModal}},[e._v("钩子")]):e._e(),r("a-button",{attrs:{type:"dashed",disabled:e.btnStatus.closeDisabled,icon:"close-circle"},on:{click:e.showCloseModal}},[e._v("关闭工单")]),r("a-button",{attrs:{type:"dashed",loading:e.executeLoading,icon:"thunderbolt"},on:{click:e.generateSqlOrdersTasks}},[e._v("执行工单")]),["处理中","已完成","已复核","已勾住"].includes(e.orderDetail.progress)?r("a-button",{attrs:{type:"dashed",icon:"eye"},on:{click:e.showTasksDrawer}},[e._v("子任务详情")]):e._e(),r("a-button",{attrs:{type:"dashed",loading:e.loading,icon:"sync"},on:{click:e.refresh}},[e._v("刷新")])],1),r("a-modal",{attrs:{title:"请输入[可选]"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("a-textarea",{attrs:{rows:"3",autoSize:{minRows:3,maxRows:5}},model:{value:e.confirmMsg,callback:function(t){e.confirmMsg=t},expression:"confirmMsg"}}),r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:e.handleCancel}},[e._v(e._s(e.confirmBtnTips.cancelText))]),r("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleOk}},[e._v(" "+e._s(e.confirmBtnTips.okText)+" ")])],1)],2),r("a-modal",{attrs:{title:"请输入[可选]"},model:{value:e.closeVisible,callback:function(t){e.closeVisible=t},expression:"closeVisible"}},[r("a-textarea",{attrs:{rows:"3",autoSize:{minRows:3,maxRows:5}},model:{value:e.confirmMsg,callback:function(t){e.confirmMsg=t},expression:"confirmMsg"}}),r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:e.handleCloseCancel}},[e._v("关闭")]),r("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleCloseOk}},[e._v("提交")])],1)],2),r("a-modal",{attrs:{title:"请选择目标环境[钩子]",width:"35%"},model:{value:e.hookVisible,callback:function(t){e.hookVisible=t},expression:"hookVisible"}},[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-width":"150px",size:"small"}},[r("el-form-item",{attrs:{label:"当前工单"}},[r("el-input",{staticStyle:{width:"95%"},attrs:{readonly:"",placeholder:"请输入标题"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),r("el-form-item",{attrs:{label:"当前库"}},[r("el-input",{staticStyle:{width:"95%"},attrs:{readonly:"",placeholder:"请输入需求描述"},model:{value:e.ruleForm.current_database,callback:function(t){e.$set(e.ruleForm,"current_database",t)},expression:"ruleForm.current_database"}})],1),r("el-form-item",{attrs:{label:"目标环境"}},[r("el-select",{staticStyle:{width:"95%"},attrs:{placeholder:"请选择工单环境",value:""},on:{change:e.changeEnvs},model:{value:e.ruleForm.env_id,callback:function(t){e.$set(e.ruleForm,"env_id",t)},expression:"ruleForm.env_id"}},e._l(e.sql_envs,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id,disabled:e.disabled}})})),1)],1),r("el-form-item",{attrs:{label:"目标库"}},[r("el-select",{staticStyle:{width:"95%"},attrs:{clearable:"",filterable:"",placeholder:"请选择目标数据库",value:""},model:{value:e.ruleForm.database,callback:function(t){e.$set(e.ruleForm,"database",t)},expression:"ruleForm.database"}},e._l(e.schemas,(function(e){return r("el-option",{key:e.id,attrs:{label:e.comment+"-"+e.schema,value:e.cid+"__"+e.schema}})})),1)],1),r("el-form-item",{attrs:{label:"审核状态"}},[r("a-switch",{attrs:{"checked-children":"重置审核状态为：待审批","un-checked-children":"继承审核状态为：已批准","default-checked":""},on:{change:e.onRestChange}})],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-select",{staticStyle:{width:"95%"},attrs:{placeholder:"请选择合适的备注",value:""},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}},e._l(e.remarks,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:e.handleHookCancel}},[e._v("关闭")]),r("a-button",{key:"submit",attrs:{type:"primary",loading:e.hookLoading},on:{click:e.handleHookOk}},[e._v("提交")])],1)],2)]},proxy:!0}],null,!1,464465046)},[r("a-card",{staticStyle:{"margin-top":"-10px"},attrs:{bordered:!1,title:"事件进度"}},[r("a-steps",{attrs:{current:e.currentStatus,size:"small"}},[r("a-step",{attrs:{title:"创建工单"}}),r("a-step",{attrs:{title:"审核中"}}),r("a-step",{attrs:{title:"已审核"}}),r("a-step",{attrs:{title:"处理中"}}),r("a-step",{attrs:{title:"已完成"}}),r("a-step",{attrs:{title:"已复核"}}),r("a-step",{attrs:{title:"已勾住"}})],1),r("a-card",{staticStyle:{"margin-top":"18px"},attrs:{type:"inner",title:"事件状态"}},[e._l(JSON.parse(e.orderDetail.auditor),(function(t){return r("a-descriptions",{key:"auditor"+t.user+t.status,attrs:{size:"small",col:4}},[r("a-descriptions-item",{attrs:{label:"审核人"}},[e._v(" "+e._s(t.user)+" "),1===t.is_superuser?r("span",[e._v("(超级审核人)")]):e._e()]),r("a-descriptions-item",{attrs:{label:"状态"}},[0===t.status?r("a-tag",{attrs:{color:"red"}},[e._v("未审核")]):1===t.status?r("a-tag",{attrs:{color:"green"}},[e._v("已审核")]):r("a-tag",{attrs:{color:"blue"}},[e._v("已驳回")])],1),r("a-descriptions-item",{attrs:{label:"审核时间"}},[e._v(e._s(t.time))]),r("a-descriptions-item",{attrs:{label:"附加信息"}},[e._v(e._s(t.msg))])],1)})),r("a-divider",{staticStyle:{margin:"5px"}}),e._l(JSON.parse(e.orderDetail.reviewer),(function(t){return r("a-descriptions",{key:"reviewer"+t.user+t.status,attrs:{size:"small",col:4}},[r("a-descriptions-item",{attrs:{label:"复核人"}},[e._v(e._s(t.user))]),r("a-descriptions-item",{attrs:{label:"状态"}},[0===t.status?r("a-tag",{attrs:{color:"red"}},[e._v("未复核")]):r("a-tag",{attrs:{color:"green"}},[e._v("已复核")])],1),r("a-descriptions-item",{attrs:{label:"复核时间"}},[e._v(e._s(t.time))]),r("a-descriptions-item",{attrs:{label:"附加信息"}},[e._v(e._s(t.msg))])],1)})),r("a-divider",{staticStyle:{margin:"5px"}}),e._l(JSON.parse(e.orderDetail.executor),(function(t){return r("a-descriptions",{key:"executor"+t.user+t.status,attrs:{size:"small",col:4}},[r("a-descriptions-item",{attrs:{label:"执行人"}},[e._v(e._s(t.user))]),r("a-descriptions-item",{attrs:{label:"状态"}},[e._v("-")]),r("a-descriptions-item",{attrs:{label:"执行时间"}},[e._v(e._s(t.time))]),r("a-descriptions-item",{attrs:{label:"附加信息"}},[e._v(e._s(t.msg))])],1)})),"已关闭"===e.orderDetail.progress?r("div",[r("a-divider",{staticStyle:{margin:"5px"}}),e._l(JSON.parse(e.orderDetail.closer),(function(t){return r("a-descriptions",{key:"closer"+t.user+t.status,attrs:{size:"small",col:4}},[r("a-descriptions-item",{attrs:{label:"关闭人"}},[e._v(e._s(t.user))]),r("a-descriptions-item",{attrs:{label:"状态"}},[e._v("-")]),r("a-descriptions-item",{attrs:{label:"关闭时间"}},[e._v(e._s(t.time))]),r("a-descriptions-item",{attrs:{label:"附加信息"}},[e._v(e._s(t.msg))])],1)}))],2):e._e()],2)],1),r("a-card",{staticStyle:{"margin-top":"-10px"},attrs:{title:"工单内容",bordered:!1}},[r("codemirror",{ref:"myCm",attrs:{options:e.cmOptions},on:{ready:e.onCmReady},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),r("a-drawer",{attrs:{title:"子任务执行详情",width:"60%",placement:"right",closable:!1,visible:e.visibleDrawer},on:{close:e.onCloseDrawer}},[r("drawerTasksPreview",{attrs:{order_id:this.orderDetail.id}})],1)],1):e._e()],1)},s=[],o=(r("caad"),r("d81d"),r("b0c0"),r("d3b7"),r("5530")),i=r("432b"),n=r("7125"),l=r("4ad3"),c=(r("ffda"),r("0f7c"),r("f4ba"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-row",{attrs:{gutter:16}},[r("a-col",{attrs:{span:6}},[r("a-statistic",{staticStyle:{"margin-right":"50px"},attrs:{title:"子任务总数量",value:this.statistics.total},scopedSlots:e._u([{key:"suffix",fn:function(){return[r("a-icon",{attrs:{type:"flag"}})]},proxy:!0}])})],1),r("a-col",{attrs:{span:6}},[r("a-statistic",{staticClass:"demo-class",attrs:{title:"已完成",value:this.statistics.progress_1},scopedSlots:e._u([{key:"suffix",fn:function(){return[r("a-icon",{attrs:{type:"flag"}})]},proxy:!0}])})],1),r("a-col",{attrs:{span:6}},[r("a-statistic",{staticClass:"demo-class",attrs:{title:"未执行",value:this.statistics.progress_0},scopedSlots:e._u([{key:"suffix",fn:function(){return[r("a-icon",{attrs:{type:"flag"}})]},proxy:!0}])})],1),r("a-col",{attrs:{span:6}},[r("a-statistic",{staticClass:"demo-class",attrs:{title:"失败",value:this.statistics.progress_3},scopedSlots:e._u([{key:"suffix",fn:function(){return[r("a-icon",{attrs:{type:"flag"}})]},proxy:!0}])})],1)],1),r("el-divider"),r("div",{staticClass:"table-page-search-wrapper"},[r("a-row",{attrs:{gutter:[8,16]}},[r("a-form",{attrs:{laout:"inline",form:e.form},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}}},[r("a-col",{attrs:{span:4}},[r("a-form-item",[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["progress"],expression:"decorator['progress']"}],attrs:{placeholder:"状态"}},e._l(e.progress,(function(t){return r("a-select-option",{key:t.key,attrs:{value:t.key}},[e._v(e._s(t.value))])})),1)],1)],1),r("a-col",{attrs:{span:6}},[r("a-form-item",[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:e.decorator["search"],expression:"decorator['search']"}],attrs:{placeholder:"输入要查询的工单内容"}})],1)],1),r("a-col",{attrs:{span:8}},[r("a-form-item",[r("span",{staticClass:"table-page-search-submitButtons"},[r("a-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),r("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.resetForm}},[e._v("重置")])],1)])],1)],1)],1)],1),r("a-table",{attrs:{columns:e.table.columns,rowKey:function(e){return e.id},dataSource:e.table.data,pagination:e.pagination,loading:e.loading,size:"middle"},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"num",fn:function(t,a,s){return r("span",{},[r("span",{domProps:{textContent:e._s(s+1)}})])}},{key:"sql",fn:function(t){return r("span",{},[r("a-tooltip",{attrs:{placement:"topLeft"}},[r("template",{slot:"title"},[e._v(e._s(t))]),r("span",{attrs:{href:"#"}},[e._v(e._s(t))])],2)],1)}},{key:"progress",fn:function(t){return r("span",{},["处理中"===t?r("span",{staticStyle:{color:"orange"}},[e._v(e._s(t))]):"已完成"===t?r("span",{staticStyle:{color:"green"}},[e._v(e._s(t))]):"失败"===t?r("span",{staticStyle:{color:"red"}},[e._v(e._s(t))]):"暂停"===t?r("span",{staticStyle:{color:"blue"}},[e._v(e._s(t))]):r("span",[e._v(e._s(t))])])}},{key:"result",fn:function(t,a){return r("span",{},[r("a-icon",{attrs:{type:"eye"},on:{click:function(t){return e.showModal(a)}}})],1)}}])}),r("div",[r("a-modal",{attrs:{title:"任务执行详情",width:"55%"},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[r("template",{slot:"footer"},[r("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("Close")])],1),r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.resultLoading,expression:"resultLoading"}],attrs:{"element-loading-text":"玩命加载中...","element-loading-spinner":"el-icon-loading"}},[r("div",[r("h5",[e._v("-> 执行日志")]),r("codemirror",{ref:"myCm2",attrs:{options:e.cmOptions},on:{ready:e.onCmReady2},model:{value:e.code2,callback:function(t){e.code2=t},expression:"code2"}})],1),r("div",{staticStyle:{"margin-top":"15px"}},[r("h5",[e._v("-> 回滚SQL")]),r("codemirror",{ref:"myCm1",attrs:{options:e.cmOptions},on:{ready:e.onCmReady1},model:{value:e.code1,callback:function(t){e.code1=t},expression:"code1"}})],1)])],2)],1)],1)}),d=[],u=(r("a9e3"),r("ac1f"),r("841c"),{name:"tasks-list",props:{order_id:Number},data:function(){return{modalLoading:!1,modalVisible:!1,resultLoading:!1,timer:"",loading:!1,progress:n["e"],statistics:{total:0,progress_0:0,progress_1:0,progress_3:0},table:{columns:null,data:null},pagination:{current:1,pageSize:10,total:0,pageSizeOptions:["10","20"],showSizeChanger:!0},decorator:{progress:["progress",{rules:[{required:!1}]}],search:["search",{rules:[{required:!1}]}]},code1:"",code2:"",cmOptions:{mode:"text/x-mysql",indentUnit:2,tabSize:2,indentWithTabs:!0,smartIndent:!0,autoRefresh:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!0,autofocus:!1},form:this.$form.createForm(this)}},methods:{handleTableChange:function(e){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.fetchData()},fetchData:function(){var e=this;Object(l["o"])({order_id:this.order_id}).then((function(t){e.task_id=t.data;var r=Object(o["a"])({page_size:e.pagination.pageSize,page:e.pagination.current,task_id:e.task_id},e.filters);e.loading=!0,Object(l["q"])(r).then((function(t){e.pagination.total=t.count,e.loading=!1,e.table.columns=t.results.columns,e.table.data=t.results.data.data,e.statistics.total=t.results.data.total,e.statistics.progress_0=t.results.data.progress_0,e.statistics.progress_1=t.results.data.progress_1,e.statistics.progress_3=t.results.data.progress_3})).finally((function(){e.loading=!1}))}))},handleSearch:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,r){e||(t.filters={progress:r["progress"],search:r["search"]},t.pagination.current=1,t.fetchData())}))},resetForm:function(){this.form.resetFields()},getTResult:function(e){var t=this;Object(l["r"])(e.id).then((function(e){t.codemirror1.setValue(e.data.rollback_sql),t.codemirror2.setValue(e.data.execute_log),setTimeout((function(){t.resultLoading=!1}),1e3)})).catch((function(e){setTimeout((function(){t.resultLoading=!1}),1e3)}))},showModal:function(e){this.modalVisible=!0,this.resultLoading=!0,this.getTResult(e)},handleCancel:function(e){this.modalVisible=!1},onCmReady1:function(e){e.setSize("height","250px")},onCmReady2:function(e){e.setSize("height","250px")}},computed:{codemirror1:function(){return this.$refs.myCm1.codemirror},codemirror2:function(){return this.$refs.myCm2.codemirror}},destroyed:function(){clearInterval(this.timer)},mounted:function(){var e=this;this.fetchData(),this.timer&&clearInterval(this.timer),this.timer=setInterval((function(){setTimeout(e.fetchData(),0)}),1e4)}}),m=u,p=r("2877"),f=Object(p["a"])(m,c,d,!1,null,null,null),h=f.exports,b={okText:"确认",cancelText:"取消",action:""},v={okText:"提交",cancelText:"关闭",action:"close"},g={btnDisabled:!1,closeDisabled:!1},_={name:"detail",mixins:[i["a"]],components:{drawerTasksPreview:h},data:function(){return{visible:!1,visibleDrawer:!1,closeVisible:!1,loading:!1,executeLoading:!1,hookLoading:!1,hookVisible:!1,btnStatus:g,confirmMsg:"",orderDetail:"",toUrl:"",confirmBtnTips:b,code:"",cmOptions:{mode:"text/x-mysql",indentUnit:2,tabSize:2,indentWithTabs:!0,smartIndent:!0,autoRefresh:!0,lineNumbers:!0,readOnly:!0,focuse:!1},schemas:[],sql_envs:[],resetAuditStatus:"ON",remarks:n["a"],ruleForm:{title:"",current_database:"",env_id:"",database:"",remark:""}}},methods:{showTasksDrawer:function(){this.visibleDrawer=!0},onCloseDrawer:function(){this.visibleDrawer=!1},getOrderDetail:function(){var e=this;Object(l["m"])(this.$route.params.order_id).then((function(t){e.orderDetail=t.data}))},changeEnvs:function(e){var t=this;this.ruleForm.database="";var r={env_id:e,use_type:0,rds_category:this.orderDetail.rds_category};Object(l["k"])(r).then((function(e){t.schemas=e.data}))},onCmReady:function(e){e.setSize("height","550px"),e.setValue(this.orderDetail.contents)},refresh:function(){var e=this;this.loading=!0,this.getOrderDetail(),setTimeout((function(){e.loading=!1}),1e3)},handleCommit:function(e,t){var r=this;if(this.confirmMsg.length>128)return this.$message.error("提交失败，消息长度不能超过128个字符"),this.hideModal(),!1;var a={action:t,msg:this.confirmMsg,btn:e,pk:this.orderDetail.id};Object(l["v"])(a).then((function(e){"0000"===e.code?r.$message.success(e.message):r.$message.error(JSON.stringify(e.message))})).finally((function(){r.hideModal(),r.refresh()}))},generateSqlOrdersTasks:function(){var e=this;this.executeLoading=!0;var t={id:this.orderDetail.id};Object(l["i"])(t).then((function(t){"0000"===t.code?e.$router.push("/sqlorders/tasks/".concat(t.data)):e.$message.error(t.message)})).finally((function(){e.executeLoading=!1}))},showModal:function(){this.visible=!0},hideModal:function(){this.visible=!1},handleOk:function(e){this.handleCommit("ok",b.action),this.hideModal()},handleCancel:function(){this.handleCommit("cancel",b.action),this.hideModal()},showHookModal:function(){var e=this;this.ruleForm.title=this.orderDetail.title,this.ruleForm.current_database=this.orderDetail.database,l["j"].then((function(t){var r=t.data;e.sql_envs=[],r.map((function(t){t.name!=e.orderDetail.env_id&&e.sql_envs.push(t)}))})),this.hookVisible=!0},hideHookModal:function(){this.hookVisible=!1},handleHookOk:function(){var e=this,t=Object(o["a"])({id:this.orderDetail.id,reset:this.resetAuditStatus},this.ruleForm);Object(l["a"])(t).then((function(t){"0000"===t.code?e.$router.push("/sqlorders/list"):e.$message.error(t.message)}))},handleHookCancel:function(){this.hideHookModal()},showCloseModal:function(){this.closeVisible=!0},hideCloseModal:function(){this.closeVisible=!1},handleCloseOk:function(e){this.handleCommit("ok",v.action),this.hideCloseModal()},handleCloseCancel:function(){this.hideCloseModal()},onRestChange:function(e){this.resetAuditStatus=e?"ON":"OFF"}},mounted:function(){this.getOrderDetail()},filters:{btnTitle:function(e){return"待审核"===e?(g.btnDisabled=!1,g.closeDisabled=!1,b.okText="同意",b.cancelText="驳回",b.action="approve","审核"):["已批准","处理中"].includes(e)?(g.btnDisabled=!1,g.closeDisabled=!1,b.okText="处理中",b.cancelText="执行完成",b.action="feedback","反馈"):"已完成"===e?(g.btnDisabled=!1,g.closeDisabled=!0,b.okText="已复核",b.cancelText="关闭窗口",b.action="review","复核"):["已关闭","已勾住","已驳回","已复核"].includes(e)?(g.btnDisabled=!0,g.closeDisabled=!0,"完成"):void 0}},computed:{codemirror:function(){return this.$refs.myCm.codemirror},currentStatus:function(){return"已驳回"===this.orderDetail.progress?2:"已关闭"===this.orderDetail.progress?4:"待审核"===this.orderDetail.progress?1:"已批准"===this.orderDetail.progress?2:"处理中"===this.orderDetail.progress?3:"已完成"===this.orderDetail.progress?4:"已复核"===this.orderDetail.progress?5:6}}},k=_,y=(r("6e43"),Object(p["a"])(k,a,s,!1,null,"44d9ac4c",null));t["default"]=y.exports},"6e43":function(e,t,r){"use strict";var a=r("ece8"),s=r.n(a);s.a},7125:function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"e",(function(){return n}));var a=[{key:1,value:"mysql"},{key:2,value:"tidb"}],s=["立即执行","上线执行"],o=[{key:"xlsx",value:"xlsx"},{key:"csv",value:"csv"}],i=[{key:0,value:"待审核",color:"warning"},{key:1,value:"已驳回",color:"danger"},{key:2,value:"已批准",color:"primary"},{key:3,value:"处理中",color:"warning"},{key:4,value:"已完成",color:"success"},{key:5,value:"已关闭",color:"danger"},{key:6,value:"已复核",color:"info"},{key:7,value:"已勾住",color:"default"}],n=[{key:0,value:"未执行"},{key:1,value:"已完成"},{key:2,value:"处理中"},{key:3,value:"失败"},{key:4,value:"异常"}]},ece8:function(e,t,r){}}]);